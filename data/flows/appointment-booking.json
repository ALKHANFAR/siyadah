{
  "_meta": {
    "id": "appointment-booking",
    "version": "1.0.0",
    "display_name": "Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
    "display_name_en": "Appointment Booking",
    "description": "Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯ â†’ Ø³Ø¬Ù‘Ù„Ù‡ â†’ ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„ â†’ ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ ÙŠÙˆÙ… â†’ ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø³Ø§Ø¹Ø©",
    "category": "operations",
    "industries": [
      "clinic",
      "consulting",
      "training",
      "general"
    ],
    "estimated_setup_time": "3 min",
    "user_request_examples": [
      "Ø£Ø¨ÙŠ Ù†Ø¸Ø§Ù… Ù…ÙˆØ§Ø¹ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ",
      "Ù„Ù…Ø§ Ø£Ø­Ø¯ ÙŠØ­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø£Ø¨ÙŠ ÙŠÙˆØµÙ„Ù‡ ØªØ£ÙƒÙŠØ¯",
      "Ø°ÙƒÙ‘Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯Ù‡Ù…",
      "Ø³Ùˆ Ù„ÙŠ Ø£ØªÙ…ØªØ© Ø­Ø¬Ø² Ù…ÙˆØ§Ø¹ÙŠØ¯",
      "Ø£Ø¨ÙŠ ØªØ£ÙƒÙŠØ¯ ÙˆØªØ°ÙƒÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"
    ],
    "intent_keywords": [
      "Ù…ÙˆØ¹Ø¯",
      "Ø­Ø¬Ø²",
      "ØªØ£ÙƒÙŠØ¯",
      "ØªØ°ÙƒÙŠØ±",
      "Ù…ÙˆØ§Ø¹ÙŠØ¯",
      "appointment",
      "booking"
    ]
  },
  "trigger": {
    "tool_id": "google-calendar",
    "action": "new_event",
    "description": "Ù„Ù…Ø§ ÙŠÙ†Ø¶Ø§Ù Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…",
    "config": {
      "calendar_id": "primary"
    },
    "expected_output": {
      "title": "Ù…ÙˆØ¹Ø¯ Ù…Ø¹ Ø£Ø­Ù…Ø¯",
      "start": "2026-03-01T10:00:00+03:00",
      "end": "2026-03-01T11:00:00+03:00",
      "attendees": [
        {
          "email": "ahmed@email.com"
        }
      ]
    },
    "alternative_triggers": [
      "calendly.new_event",
      "webhook.catch_webhook",
      "google-sheets.new_row"
    ]
  },
  "steps": [
    {
      "order": 1,
      "id": "extract_customer_info",
      "tool_id": "code",
      "action": "run_javascript",
      "description": "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯",
      "config": {
        "code": "const title = inputs.title || ''; const nameMatch = title.match(/Ù…Ø¹\\s+(.+)/); const customer_name = nameMatch ? nameMatch[1] : title; const email = inputs.attendees && inputs.attendees[0] ? inputs.attendees[0].email : ''; const start = new Date(inputs.start); const day = start.toLocaleDateString('ar-SA', {weekday: 'long'}); const time = start.toLocaleTimeString('ar-SA', {hour: '2-digit', minute: '2-digit', hour12: true}); const date = start.toLocaleDateString('ar-SA'); return { customer_name, email, day_name: day, time_formatted: time, date_formatted: date };"
      },
      "input_mapping": {
        "title": "{{trigger.title}}",
        "attendees": "{{trigger.attendees}}",
        "start": "{{trigger.start}}"
      },
      "on_error": {
        "action": "continue",
        "fallback_value": {
          "customer_name": "Ø§Ù„Ø¹Ù…ÙŠÙ„",
          "day_name": "",
          "time_formatted": "",
          "date_formatted": ""
        }
      }
    },
    {
      "order": 2,
      "id": "save_to_sheet",
      "tool_id": "google-sheets",
      "action": "insert_row",
      "description": "Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
      "config": {
        "spreadsheet_id": "{{company.appointments_spreadsheet_id}}",
        "sheet_name": "Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"
      },
      "input_mapping": {
        "values": {
          "Ø§Ù„Ø§Ø³Ù…": "{{step.extract_customer_info.customer_name}}",
          "Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„": "{{step.extract_customer_info.email}}",
          "Ø§Ù„ØªØ§Ø±ÙŠØ®": "{{step.extract_customer_info.date_formatted}}",
          "Ø§Ù„ÙŠÙˆÙ…": "{{step.extract_customer_info.day_name}}",
          "Ø§Ù„ÙˆÙ‚Øª": "{{step.extract_customer_info.time_formatted}}",
          "Ø§Ù„Ø­Ø§Ù„Ø©": "Ù…Ø¤ÙƒØ¯"
        }
      },
      "on_error": {
        "action": "retry_then_alert",
        "retry_count": 3,
        "error_codes": {
          "SPREADSHEET_NOT_FOUND": "auto_create_spreadsheet"
        }
      },
      "critical": true,
      "never_skip": true
    },
    {
      "order": 3,
      "id": "send_confirmation",
      "tool_id": "whatsapp-business",
      "action": "send_message",
      "description": "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù„Ù„Ø¹Ù…ÙŠÙ„",
      "input_mapping": {
        "phone_number": "{{company.customer_phone_lookup(step.extract_customer_info.email)}}",
        "message": "{{templates.appointment.confirmation}}"
      },
      "variable_injection": {
        "customer_name": "{{step.extract_customer_info.customer_name}}",
        "company_name": "{{company.company_name}}",
        "date": "{{step.extract_customer_info.date_formatted}}",
        "day": "{{step.extract_customer_info.day_name}}",
        "time": "{{step.extract_customer_info.time_formatted}}",
        "location": "{{company.address}}"
      },
      "on_error": {
        "action": "fallback_chain",
        "chain": [
          {
            "tool_id": "gmail",
            "action": "send_email",
            "to": "{{step.extract_customer_info.email}}",
            "condition": "has_email"
          }
        ]
      },
      "critical": true,
      "never_skip": true
    },
    {
      "order": 4,
      "id": "notify_team",
      "tool_id": "slack",
      "action": "send_message",
      "description": "ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
      "input_mapping": {
        "channel": "{{company.notification_channel}}",
        "text": "ğŸ“… Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯\nğŸ‘¤ {{step.extract_customer_info.customer_name}}\nğŸ—“ï¸ {{step.extract_customer_info.day_name}} {{step.extract_customer_info.date_formatted}}\nğŸ• {{step.extract_customer_info.time_formatted}}"
      },
      "on_error": {
        "action": "fallback_chain",
        "chain": [
          {
            "tool_id": "telegram",
            "action": "send_text_message",
            "condition": "telegram_connected"
          },
          {
            "tool_id": "gmail",
            "action": "send_email",
            "to": "{{company.owner_email}}",
            "condition": "always"
          }
        ]
      }
    },
    {
      "order": 5,
      "id": "schedule_day_before_reminder",
      "tool_id": "delay",
      "action": "delay_for",
      "description": "Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨ÙŠÙˆÙ…",
      "config": {
        "amount": "{{calculated.hours_until_day_before}}",
        "unit": "hours"
      },
      "on_error": {
        "action": "log_and_continue"
      }
    },
    {
      "order": 6,
      "id": "send_day_before_reminder",
      "tool_id": "whatsapp-business",
      "action": "send_message",
      "description": "ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨ÙŠÙˆÙ…",
      "input_mapping": {
        "phone_number": "{{company.customer_phone_lookup(step.extract_customer_info.email)}}",
        "message": "{{templates.appointment.reminder_day_before}}"
      },
      "variable_injection": {
        "customer_name": "{{step.extract_customer_info.customer_name}}",
        "company_name": "{{company.company_name}}",
        "time": "{{step.extract_customer_info.time_formatted}}",
        "location": "{{company.address}}"
      },
      "on_error": {
        "action": "fallback_chain",
        "chain": [
          {
            "tool_id": "gmail",
            "action": "send_email",
            "condition": "has_email"
          }
        ]
      }
    },
    {
      "order": 7,
      "id": "schedule_hour_before_reminder",
      "tool_id": "delay",
      "action": "delay_for",
      "description": "Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ø³Ø§Ø¹Ø©",
      "config": {
        "amount": 23,
        "unit": "hours"
      },
      "on_error": {
        "action": "log_and_continue"
      }
    },
    {
      "order": 8,
      "id": "send_hour_before_reminder",
      "tool_id": "whatsapp-business",
      "action": "send_message",
      "description": "ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ø³Ø§Ø¹Ø©",
      "input_mapping": {
        "phone_number": "{{company.customer_phone_lookup(step.extract_customer_info.email)}}",
        "message": "{{templates.appointment.reminder_hour_before}}"
      },
      "variable_injection": {
        "customer_name": "{{step.extract_customer_info.customer_name}}",
        "company_name": "{{company.company_name}}",
        "time": "{{step.extract_customer_info.time_formatted}}"
      },
      "on_error": {
        "action": "fallback_chain",
        "chain": [
          {
            "tool_id": "gmail",
            "action": "send_email",
            "condition": "has_email"
          }
        ]
      }
    }
  ],
  "branches": [],
  "delays": [
    {
      "after_step": "notify_team",
      "purpose": "Day-before reminder",
      "dynamic": true
    },
    {
      "after_step": "send_day_before_reminder",
      "duration": {
        "amount": 23,
        "unit": "hours"
      },
      "purpose": "Hour-before reminder"
    }
  ],
  "required_connections": [
    "google-calendar",
    "google-sheets"
  ],
  "recommended_connections": [
    "whatsapp-business",
    "slack",
    "gmail"
  ],
  "minimum_connections": [
    "google-calendar",
    "gmail"
  ],
  "required_variables": {
    "company": [
      "company_name",
      "appointments_spreadsheet_id"
    ],
    "trigger": [
      "title",
      "start"
    ]
  },
  "sheets_template": {
    "name": "Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
    "columns": [
      "Ø§Ù„Ø§Ø³Ù…",
      "Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„",
      "Ø§Ù„Ø¬ÙˆØ§Ù„",
      "Ø§Ù„ØªØ§Ø±ÙŠØ®",
      "Ø§Ù„ÙŠÙˆÙ…",
      "Ø§Ù„ÙˆÙ‚Øª",
      "Ø§Ù„Ø­Ø§Ù„Ø©",
      "Ù…Ù„Ø§Ø­Ø¸Ø§Øª"
    ]
  },
  "industry_variants": {
    "clinic": {
      "sheets_extra_columns": [
        "Ø§Ù„ØªØ®ØµØµ",
        "Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø©",
        "Ø§Ù„ØªØ£Ù…ÙŠÙ†"
      ],
      "reminder_extra": "ÙŠØ±Ø¬Ù‰ Ø¥Ø­Ø¶Ø§Ø± Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†",
      "confirmation_extra": "Ø§Ù„Ù†ÙˆØ¹: {{appointment_type}}"
    },
    "consulting": {
      "sheets_extra_columns": [
        "Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
        "Ù…Ø¯Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹"
      ],
      "reminder_extra": "ÙŠØ±Ø¬Ù‰ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©",
      "confirmation_extra": "Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¹Ø¨Ø±: {{meeting_platform}}"
    },
    "training": {
      "sheets_extra_columns": [
        "Ø§Ù„Ø¯ÙˆØ±Ø©",
        "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†"
      ],
      "reminder_extra": "ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ù…Ø³Ø¨Ù‚Ø§Ù‹"
    }
  },
  "protection": {
    "idempotency": "hash(calendar_event_id) â€” one confirmation per event",
    "rate_limit": "Max 200 appointments/day",
    "data_validation": "Start time must be in the future, event must have title",
    "cancellation_handling": "If event deleted â†’ send cancellation message â†’ update sheet"
  },
  "expected_execution_time": "5 seconds (confirmation) + delays for reminders",
  "success_criteria": {
    "must": [
      "Appointment recorded in sheet",
      "Confirmation sent to customer"
    ],
    "should": [
      "Day-before reminder sent",
      "Hour-before reminder sent"
    ],
    "nice": [
      "Team notified",
      "Cancellation handled"
    ]
  }
}