{
  "_meta": {
    "id": "weekly-report",
    "version": "1.0.0",
    "display_name": "Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ",
    "display_name_en": "Weekly Report",
    "description": "ÙƒÙ„ Ø£Ø­Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 9 â†’ Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â†’ AI ÙŠÙ„Ø®Ù‘Øµ â†’ Ø£Ø±Ø³Ù„ Ù„Ù„Ù…Ø¯ÙŠØ±",
    "category": "reports",
    "industries": [
      "all"
    ],
    "estimated_setup_time": "3 min",
    "user_request_examples": [
      "Ø£Ø¨ÙŠ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø¹Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡",
      "Ø£Ø±Ø³Ù„ Ù„ÙŠ Ù…Ù„Ø®Øµ ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹",
      "Ø£Ø¨ÙŠ Ø£Ø¹Ø±Ù ÙƒÙ… Ø¹Ù…ÙŠÙ„ Ø¬Ø§Ù†ÙŠ Ù‡Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
      "Ø³Ùˆ Ù„ÙŠ ØªÙ‚Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ"
    ],
    "intent_keywords": [
      "ØªÙ‚Ø±ÙŠØ±",
      "Ø£Ø³Ø¨ÙˆØ¹ÙŠ",
      "Ù…Ù„Ø®Øµ",
      "Ø£Ø¯Ø§Ø¡",
      "report",
      "weekly",
      "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª"
    ]
  },
  "trigger": {
    "tool_id": "schedule",
    "action": "every_week",
    "description": "ÙƒÙ„ ÙŠÙˆÙ… Ø£Ø­Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© 9 ØµØ¨Ø§Ø­Ø§Ù‹",
    "config": {
      "day_of_week": 0,
      "hour": 9,
      "timezone": "Asia/Riyadh"
    },
    "alternative_triggers": [
      "schedule.every_day"
    ]
  },
  "steps": [
    {
      "order": 1,
      "id": "fetch_leads_data",
      "tool_id": "google-sheets",
      "action": "find_rows",
      "description": "Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
      "config": {
        "spreadsheet_id": "{{company.leads_spreadsheet_id}}",
        "sheet_name": "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"
      },
      "input_mapping": {
        "column_name": "Ø§Ù„ØªØ§Ø±ÙŠØ®",
        "value": "{{context.this_week}}"
      },
      "on_error": {
        "action": "retry_then_alert",
        "retry_count": 3
      },
      "critical": true,
      "never_skip": true
    },
    {
      "order": 2,
      "id": "fetch_invoices_data",
      "tool_id": "google-sheets",
      "action": "find_rows",
      "description": "Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",
      "config": {
        "spreadsheet_id": "{{company.invoices_spreadsheet_id}}",
        "sheet_name": "Ø§Ù„ÙÙˆØ§ØªÙŠØ±"
      },
      "input_mapping": {
        "column_name": "Ø§Ù„ØªØ§Ø±ÙŠØ®",
        "value": "{{context.this_week}}"
      },
      "on_error": {
        "action": "continue",
        "fallback_value": {
          "rows": [],
          "count": 0
        }
      }
    },
    {
      "order": 3,
      "id": "calculate_stats",
      "tool_id": "code",
      "action": "run_javascript",
      "description": "Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª",
      "config": {
        "code": "const leads = inputs.leads || []; const invoices = inputs.invoices || []; const hot = leads.filter(l => l['Ø§Ù„Ù†ÙˆØ¹'] === 'hot').length; const warm = leads.filter(l => l['Ø§Ù„Ù†ÙˆØ¹'] === 'warm').length; const cold = leads.filter(l => l['Ø§Ù„Ù†ÙˆØ¹'] === 'cold').length; const total_revenue = invoices.filter(i => i['Ø§Ù„Ø­Ø§Ù„Ø©'] === 'Ù…Ø¯ÙÙˆØ¹Ø©').reduce((s,i) => s + parseFloat(i['Ø§Ù„Ù…Ø¨Ù„Øº'] || 0), 0); const unpaid = invoices.filter(i => i['Ø§Ù„Ø­Ø§Ù„Ø©'] === 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©').length; return { total_leads: leads.length, hot, warm, cold, total_revenue, unpaid_invoices: unpaid };"
      },
      "input_mapping": {
        "leads": "{{step.fetch_leads_data.rows}}",
        "invoices": "{{step.fetch_invoices_data.rows}}"
      },
      "on_error": {
        "action": "continue",
        "fallback_value": {
          "total_leads": 0,
          "total_revenue": 0
        }
      }
    },
    {
      "order": 4,
      "id": "format_phone",
      "tool_id": "code",
      "action": "run_javascript",
      "description": "ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ±",
      "config": {
        "code": "const phone = (inputs.phone || \"\").replace(/^0/, \"+966\").replace(/^966/, \"+966\"); return { formatted_phone: phone };"
      },
      "input_mapping": {
        "phone": "{{company.owner_phone}}"
      },
      "on_error": {
        "action": "continue",
        "fallback_value": {
          "formatted_phone": "{{company.owner_phone}}"
        }
      }
    },
    {
      "order": 5,
      "id": "ai_summary",
      "tool_id": "openai",
      "action": "ask_chatgpt",
      "description": "Ù…Ù„Ø®Øµ Ø°ÙƒÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ",
      "config": {
        "model": "gpt-4o",
        "temperature": 0.4,
        "prompt": "Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù…Ø®ØªØµØ± Ù„ØµØ§Ø­Ø¨ Ø´Ø±ÙƒØ© {{company.industry}}:\n\nØ§Ù„Ø¹Ù…Ù„Ø§Ø¡: {{step.calculate_stats.total_leads}} (ğŸ”¥ Ø¬Ø§Ø¯: {{step.calculate_stats.hot}} | ğŸŸ¡ Ù…Ù‡ØªÙ…: {{step.calculate_stats.warm}} | ğŸ”µ Ø¨Ø§Ø±Ø¯: {{step.calculate_stats.cold}})\nØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: {{step.calculate_stats.total_revenue}} Ø±ÙŠØ§Ù„\nÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©: {{step.calculate_stats.unpaid_invoices}}\n\nØ§ÙƒØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø´ÙƒÙ„ Ù…Ø®ØªØµØ± Ù…Ø¹ ØªÙˆØµÙŠØ§Øª Ø¹Ù…Ù„ÙŠØ©. Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ù„Ø§ ØªØ²ÙŠØ¯ Ø¹Ù† 200 ÙƒÙ„Ù…Ø©."
      },
      "on_error": {
        "action": "fallback_rules",
        "fallback": {
          "template": "ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:\nğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: {{step.calculate_stats.total_leads}}\nğŸ’° Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: {{step.calculate_stats.total_revenue}} Ø±ÙŠØ§Ù„\nğŸ“„ ÙÙˆØ§ØªÙŠØ± Ù…Ø¹Ù„Ù‚Ø©: {{step.calculate_stats.unpaid_invoices}}"
        }
      }
    },
    {
      "order": 6,
      "id": "send_report",
      "tool_id": "whatsapp-business",
      "action": "send_message",
      "description": "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ù…Ø¯ÙŠØ±",
      "input_mapping": {
        "phone_number": "{{company.owner_phone}}",
        "message": "ğŸ“Š ØªÙ‚Ø±ÙŠØ± {{company.company_name}} Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ\n\n{{step.ai_summary.response}}"
      },
      "on_error": {
        "action": "fallback_chain",
        "chain": [
          {
            "tool_id": "gmail",
            "action": "send_email",
            "to": "{{company.owner_email}}",
            "condition": "always"
          },
          {
            "tool_id": "slack",
            "action": "send_message",
            "condition": "slack_connected"
          }
        ]
      },
      "critical": true,
      "never_skip": true
    }
  ],
  "branches": [],
  "delays": [],
  "required_connections": [
    "google-sheets",
    "schedule"
  ],
  "recommended_connections": [
    "openai",
    "whatsapp-business",
    "gmail"
  ],
  "minimum_connections": [
    "google-sheets",
    "gmail",
    "schedule"
  ],
  "required_variables": {
    "company": [
      "company_name",
      "leads_spreadsheet_id",
      "owner_phone"
    ],
    "trigger": []
  },
  "sheets_template": {
    "name": "Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
    "columns": [
      "Ø§Ù„Ø§Ø³Ù…",
      "Ø§Ù„Ø¬ÙˆØ§Ù„",
      "Ø§Ù„Ù†ÙˆØ¹",
      "Ø§Ù„ØªØ§Ø±ÙŠØ®"
    ]
  },
  "industry_variants": {
    "clinic": {
      "extra_metrics": [
        "Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
        "Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±"
      ]
    },
    "ecommerce": {
      "extra_metrics": [
        "Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
        "Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨",
        "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹"
      ]
    },
    "restaurant": {
      "extra_metrics": [
        "Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ",
        "Ø£ÙƒØ«Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù Ø·Ù„Ø¨Ø§Ù‹"
      ]
    }
  },
  "protection": {
    "idempotency": "hash(week_number + year) â€” one report per week",
    "degradation": "If AI fails â†’ send raw stats. If sheets fail â†’ send 'no data' alert"
  },
  "expected_execution_time": "15-30 seconds",
  "success_criteria": {
    "must": [
      "Report delivered to owner"
    ],
    "should": [
      "AI-generated summary with insights"
    ],
    "nice": [
      "Stats accurately calculated from live data"
    ]
  }
}